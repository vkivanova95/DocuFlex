{% extends 'base.html' %}
{% load static %}
{% if form.non_field_errors %}
        <div class="alert alert-danger">
        {{ form.non_field_errors }}
        </div>
    {% endif %}

{% block content %}

<div class="container">
<div class="card shadow-sm p-4">
    <h4 class="custom-header">
    {% if object %}–†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä {% else %}–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ –¥–æ–≥–æ–≤–æ—Ä{% endif %}
    </h4>

<form method="post">
  {% csrf_token %}

<div class="text-start">

<!-- –û–°–ù–û–í–ù–ò –î–ê–ù–ù–ò -->
    <h4 class="custom-header">
    <h5 class="mt-4">üè¢ –û—Å–Ω–æ–≤–Ω–∏ –¥–∞–Ω–Ω–∏</h5>
    <div class="row">
         <div class="col-md-6 mb-3">
            <label for="id_eik" class="form-label">–ï–ò–ö</label>
            {% if form.fields.eik.required %}<span class="text-danger">*</span>{% endif %}
            {{ form.eik }}
            {{ form.eik.errors }}
        </div>
        <div class="col-md-6 mb-3">
            <label for="id_name" class="form-label">–ò–º–µ –Ω–∞ —Ñ–∏—Ä–º–∞—Ç–∞</label>
            {{ form.name }}
            {{ form.name.errors }}
        </div>
    </div>

<!-- –î–ê–ù–ù–ò –ó–ê –ö–†–ï–î–ò–¢–ê -->
    <h5 class="mt-4">üí∂ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∞</h5>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="id_contract_number" class="form-label">–î–æ–≥–æ–≤–æ—Ä –Ω–æ–º–µ—Ä</label>
            {% if form.fields.contract_number.required %}<span class="text-danger">*</span>{% endif %}
            {{ form.contract_number }}
            {{ form.contract_number.errors }}
        </div>
        <div class="col-md-6 mb-3">
            <label for="id_start_date" class="form-label">–î–∞—Ç–∞</label>
            {% if form.fields.start_date.required %}<span class="text-danger">*</span>{% endif %}
            {{ form.start_date }}
            {{ form.start_date.errors }}
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="id_loan_type" class="form-label">–í–∏–¥ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–∞</label>
            {{ form.loan_type }}
            {{ form.loan_type.errors }}
        </div>
         <div class="col-md-3 mb-3">
          <label for="id_currency" class="form-label">–í–∞–ª—É—Ç–∞</label>
          {% if form.fields.currency.required %}<span class="text-danger">*</span>{% endif %}
          {{ form.currency }}
          {{ form.currency.errors }}
        </div>

        <div class="col-md-4 mb-3">
            <label for="id_amount" class="form-label">–°—É–º–∞</label>
            {% if form.fields.amount.required %}<span class="text-danger">*</span>{% endif %}
            {{ form.amount }}
            {{ form.amount.errors }}
        </div>

    <div class="form-check mb-3">
      {{ form.is_active }}
      <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
          –ê–∫—Ç–∏–≤–µ–Ω –¥–æ–≥–æ–≤–æ—Ä
      </label>
    </div>

    </div>
    <div class="text-center">
      <button type="submit" class="btn btn-primary px-4">–ó–∞–ø–∏—à–∏ –¥–æ–≥–æ–≤–æ—Ä–∞</button>
    </div>
</div>
</form>
</div>
    <p class="text-muted small mt-3">
        <span class="text-danger">*</span> –ü–æ–ª–µ—Ç–∞—Ç–∞ —Å–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏.
    </p>
</div>


<script>
  const eikField = document.getElementById('id_eik');
  const nameField = document.getElementById('client_name');

  if (eikField && nameField) {
    eikField.addEventListener('change', function () {
      const eik = eikField.value;

      fetch(`/contracts/get-client-name/?eik=${eik}`)
        .then(response => {
          if (!response.ok) throw new Error();
          return response.json();
        })
        .then(data => {
          if (data.name) {
            nameField.value = data.name;
          } else {
            nameField.value = '–ö–ª–∏–µ–Ω—Ç—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω';
          }
        })
        .catch(() => {
          nameField.value = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ';
        });
    });
  }
</script>

{% endblock %}